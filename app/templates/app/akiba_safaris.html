{% extends 'base.html' %}
{% load static %}
{% block content %}

{% block title %}
<title>Akiba Safaris Payment Plan - Raw Unwind Safaris</title>
{% endblock %}
<style>
    .container {
        margin-top: 10px;
        max-width: 800px;
        margin: 0 auto;
        background: white;
        border-radius: 20px;
        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        overflow: hidden;
    }

    .header {
        background: rgb(3, 51, 3);
        color: white;
        padding: 30px;
        text-align: center;
    }

    .header h1 {
        font-size: 28px;
        margin-bottom: 10px;
    }

    .header p {
        font-size: 16px;
        opacity: 0.9;
    }

    .content {
        padding: 30px;
    }

    .form-group {
        margin-bottom: 25px;
    }

    label {
        display: block;
        margin-bottom: 8px;
        font-weight: 600;
        color: rgb(3, 51, 3);
        font-size: 14px;
    }

    select,
    input {
        width: 100%;
        padding: 12px;
        border: 2px solid #e0e0e0;
        border-radius: 8px;
        font-size: 16px;
        transition: border-color 0.3s;
    }

    select:focus,
    input:focus {
        outline: none;
        border-color: rgb(3, 51, 3);
    }

    .info-box {
        background: #f0f4ff;
        border-left: 4px solid rgb(3, 51, 3);
        padding: 15px;
        margin: 20px 0;
        border-radius: 8px;
    }

    .info-box h3 {
        color: rgb(3, 51, 3);
        margin-bottom: 10px;
        font-size: 18px;
    }

    .info-box p {
        color: #555;
        line-height: 1.6;
        margin-bottom: 5px;
    }

    .results {
        background: linear-gradient(135deg, #97979b 0%, #aeaab1 100%);
        color: white;
        padding: 25px;
        border-radius: 12px;
        margin-top: 30px;
        display: none;
    }

    .results.active {
        display: block;
        animation: fadeIn 0.5s;
    }

    @keyframes fadeIn {
        from {
            opacity: 0;
            transform: translateY(20px);
        }

        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    .result-item {
        display: flex;
        justify-content: space-between;
        padding: 12px 0;
        border-bottom: 1px solid rgba(255, 255, 255, 0.2);
    }

    .result-item:last-child {
        border-bottom: none;
    }

    .result-label {
        font-weight: 500;
    }

    .result-value {
        font-weight: 700;
        font-size: 18px;
    }

    .total-amount {
        background: rgba(255, 255, 255, 0.2);
        padding: 15px;
        border-radius: 8px;
        margin-top: 15px;
        text-align: center;
    }

    .total-amount .amount {
        font-size: 32px;
        font-weight: 700;
        margin: 10px 0;
    }

    .buttons {
        display: flex;
        gap: 15px;
        margin-top: 20px;
    }

    .btn {
        flex: 1;
        padding: 15px;
        border: none;
        border-radius: 8px;
        font-size: 16px;
        font-weight: 600;
        cursor: pointer;
        transition: transform 0.2s, box-shadow 0.2s;
    }

    .btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
    }

    .btn-calculate {
        background: rgb(3, 51, 3);
        color: white;
    }

    .btn-whatsapp {
        background: #25D366;
        color: white;
        display: none;
    }

    .btn-whatsapp.active {
        display: block;
    }

    .whatsapp-icon {
        margin-right: 5px;
    }

    .payment-schedule {
        margin-top: 20px;
        background: white;
        padding: 20px;
        border-radius: 8px;
        color: #333;
    }

    .payment-schedule h3 {
        color: rgb(3, 51, 3);
        margin-bottom: 15px;
    }

    .schedule-item {
        display: flex;
        justify-content: space-between;
        padding: 10px;
        border-bottom: 1px solid #e0e0e0;
    }

    .schedule-item:last-child {
        border-bottom: none;
    }

    .badge {
        background: #ffd700;
        color: #333;
        padding: 3px 10px;
        border-radius: 12px;
        font-size: 12px;
        font-weight: 600;
    }

    .note {
        background: #fff3cd;
        border-left: 4px solid rgb(3, 51, 3);
        padding: 12px;
        margin-top: 15px;
        border-radius: 4px;
        font-size: 14px;
        color: #856404;
    }

    @media (max-width: 600px) {
        .buttons {
            flex-direction: column;
        }

        .header h1 {
            font-size: 24px;
        }
    }
</style>
<br>
<div class="container">
    <div class="header">
        <h1>üå¥ Akiba Safaris Payment Plan</h1>
        <p>Flexible, Interest-Free Installments | Raw Unwind Safaris</p>
    </div>

    <div class="content">
        <div class="info-box">
            <h3>‚ú® Coast Experience Package</h3>
            <p><strong>Includes:</strong> SGR Nairobi-Mombasa Return (KES 3,000) + Accommodation</p>
            <p><strong>Destinations:</strong> Malindi, Mtwapa, Watamu, Kilifi, Mombasa, Diani</p>
            <p><strong>Accommodation:</strong></p>
            <p>‚Ä¢ Half Board (Breakfast + Dinner): KES 23,000 per person</p>
            <p>‚Ä¢ Full Board (All Meals): KES 29,500 per person</p>
            <p><strong>Note:</strong> Festival period pricing varies - contact us for special rates</p>
        </div>

        <form id="akibaForm">
            <div class="form-group">
                <label for="destination">Select Destination</label>
                <select id="destination" required>
                    <option value="">Choose your coastal destination...</option>
                    <option value="Malindi">Malindi</option>
                    <option value="Mtwapa">Mtwapa</option>
                    <option value="Watamu">Watamu</option>
                    <option value="Kilifi">Kilifi</option>
                    <option value="Mombasa">Mombasa</option>
                    <option value="Diani">Diani</option>
                </select>
            </div>

            <div class="form-group">
                <label for="boardType">Board Type</label>
                <select id="boardType" required>
                    <option value="">Choose board type...</option>
                    <option value="23000">Half Board - KES 23,000 (Breakfast + Dinner)</option>
                    <option value="29500">Full Board - KES 29,500 (All Meals)</option>
                </select>
            </div>

            <div class="form-group">
                <label for="travelers">Number of Travelers</label>
                <input type="number" id="travelers" min="1" max="20" value="1" required>
            </div>

            <div class="form-group">
                <label for="duration">Duration (Nights)</label>
                <input type="number" id="duration" min="1" max="14" value="3" required>
            </div>

            <div class="form-group">
                <label for="paymentPlan">Payment Plan</label>
                <select id="paymentPlan" required>
                    <option value="">Choose payment plan...</option>
                    <option value="3">3 Months (Interest-Free)</option>
                    <option value="6">6 Months (Interest-Free)</option>
                    <option value="9">9 Months (Interest-Free)</option>
                    <option value="12">12 Months (Interest-Free)</option>
                </select>
            </div>

            <div class="buttons">
                <button type="button" class="btn btn-calculate" onclick="calculatePayment()">
                    üí∞ Calculate Payment Plan
                </button>
            </div>
        </form>

        <div id="results" class="results">
            <div class="result-item">
                <span class="result-label">Package Details:</span>
                <span class="result-value" id="packageDetails"></span>
            </div>
            <div class="result-item">
                <span class="result-label">SGR Return Tickets:</span>
                <span class="result-value" id="sgrCost"></span>
            </div>
            <div class="result-item">
                <span class="result-label">Accommodation Cost:</span>
                <span class="result-value" id="accommodationCost"></span>
            </div>
            <div class="result-item">
                <span class="result-label">Total Package Price:</span>
                <span class="result-value" id="totalPrice"></span>
            </div>
            <div class="result-item">
                <span class="result-label">Initial Deposit (20%):</span>
                <span class="result-value" id="deposit"></span>
            </div>
            <div class="result-item">
                <span class="result-label">Monthly Installment:</span>
                <span class="result-value" id="monthlyPayment"></span>
            </div>

            <div class="total-amount">
                <div style="font-size: 16px; opacity: 0.9;">Your Monthly Payment</div>
                <div class="amount" id="finalAmount">KES 0</div>
                <div style="font-size: 14px; opacity: 0.9;" id="planDuration"></div>
            </div>

            <div class="payment-schedule" id="scheduleContainer">
                <h3>üìÖ Payment Schedule</h3>
                <div id="schedule"></div>
            </div>

            <div class="note">
                <strong>üéâ 0% Interest!</strong> All Akiba Safaris payment plans are completely interest-free.
                Final payment due 30 days before travel date.
            </div>

            <div class="buttons">
                <button type="button" class="btn btn-whatsapp active" onclick="shareOnWhatsApp()">
                    <span class="whatsapp-icon">üì±</span> Share on WhatsApp
                </button>
            </div>
        </div>
    </div>
</div>
<br>

<script>
    let calculationData = {};

    function formatCurrency(amount) {
        return 'KES ' + amount.toLocaleString('en-KE', { minimumFractionDigits: 0, maximumFractionDigits: 0 });
    }

    function calculatePayment() {
        const destination = document.getElementById('destination').value;
        const boardType = document.getElementById('boardType').value;
        const travelers = parseInt(document.getElementById('travelers').value);
        const duration = parseInt(document.getElementById('duration').value);
        const paymentPlan = parseInt(document.getElementById('paymentPlan').value);

        if (!destination || !boardType || !travelers || !duration || !paymentPlan) {
            alert('Please fill in all fields');
            return;
        }

        // SGR cost per person (return ticket)
        const sgrPerPerson = 3000;
        const totalSGR = sgrPerPerson * travelers;

        // Accommodation cost
        const accommodationPerNight = parseInt(boardType);
        const totalAccommodation = accommodationPerNight * travelers * duration;

        // Total package price
        const totalPrice = totalSGR + totalAccommodation;

        // Deposit (20%)
        const deposit = totalPrice * 0.20;

        // Remaining balance
        const remainingBalance = totalPrice - deposit;

        // Monthly payment
        const monthlyPayment = remainingBalance / paymentPlan;

        // Store data for WhatsApp sharing
        calculationData = {
            destination,
            boardType: boardType === '23000' ? 'Half Board' : 'Full Board',
            boardAmount: parseInt(boardType),
            travelers,
            duration,
            paymentPlan,
            totalSGR,
            totalAccommodation,
            totalPrice,
            deposit,
            monthlyPayment,
            remainingBalance
        };

        // Display results
        document.getElementById('packageDetails').textContent =
            `${destination} - ${calculationData.boardType} (${travelers} pax, ${duration} nights)`;
        document.getElementById('sgrCost').textContent = formatCurrency(totalSGR);
        document.getElementById('accommodationCost').textContent = formatCurrency(totalAccommodation);
        document.getElementById('totalPrice').textContent = formatCurrency(totalPrice);
        document.getElementById('deposit').textContent = formatCurrency(deposit);
        document.getElementById('monthlyPayment').textContent = formatCurrency(monthlyPayment);
        document.getElementById('finalAmount').textContent = formatCurrency(monthlyPayment);
        document.getElementById('planDuration').textContent =
            `Over ${paymentPlan} months (0% interest)`;

        // Generate payment schedule
        generateSchedule(deposit, monthlyPayment, paymentPlan);

        // Show results
        document.getElementById('results').classList.add('active');

        // Scroll to results
        document.getElementById('results').scrollIntoView({ behavior: 'smooth', block: 'nearest' });
    }

    function generateSchedule(deposit, monthlyPayment, months) {
        const scheduleDiv = document.getElementById('schedule');
        let html = '';

        // Deposit
        html += `
                <div class="schedule-item">
                    <span><strong>Booking Deposit</strong> <span class="badge">TODAY</span></span>
                    <span><strong>${formatCurrency(deposit)}</strong></span>
                </div>
            `;

        // Monthly installments
        for (let i = 1; i <= months; i++) {
            html += `
                    <div class="schedule-item">
                        <span>Month ${i} Payment</span>
                        <span>${formatCurrency(monthlyPayment)}</span>
                    </div>
                `;
        }

        scheduleDiv.innerHTML = html;
    }

    function shareOnWhatsApp() {
        const data = calculationData;

        const message = `üå¥ *RAW UNWIND SAFARIS - AKIBA PAYMENT PLAN*

üìç *Destination:* ${data.destination}
üè® *Board Type:* ${data.boardType}
üë• *Travelers:* ${data.travelers} person(s)
üìÖ *Duration:* ${data.duration} night(s)

üí∞ *PACKAGE BREAKDOWN:*
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
üöÜ SGR Return Tickets: ${formatCurrency(data.totalSGR)}
üè® Accommodation (${formatCurrency(data.boardAmount)} x ${data.travelers} x ${data.duration}): ${formatCurrency(data.totalAccommodation)}

üìä *TOTAL PACKAGE PRICE:* ${formatCurrency(data.totalPrice)}

üí≥ *AKIBA PAYMENT PLAN (${data.paymentPlan} MONTHS):*
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
‚úÖ Deposit (20%): ${formatCurrency(data.deposit)}
‚úÖ Monthly Payment: ${formatCurrency(data.monthlyPayment)}
‚úÖ *0% INTEREST - COMPLETELY FREE!*

üéâ *WHAT'S INCLUDED:*
‚úì SGR Nairobi-Mombasa return tickets
‚úì ${data.boardType} accommodation
‚úì All taxes and service charges
‚úì 100% carbon offset (Net-Zero certified)
‚úì 40% revenue to local communities

üì± *BOOK NOW:*
WhatsApp: +254 712 420 338
Email: bookings@rawunwind.com

üåü _Flexible payments. Zero interest. Unforgettable experiences._

*Raw Unwind Safaris*
www.rawunwind.vercel.app`;

        const encodedMessage = encodeURIComponent(message);
        const whatsappURL = `https://wa.me/?text=${encodedMessage}`;

        window.open(whatsappURL, '_blank');
    }

    // Auto-calculate when form changes (optional)
    document.getElementById('akibaForm').addEventListener('change', function () {
        const destination = document.getElementById('destination').value;
        const boardType = document.getElementById('boardType').value;
        const paymentPlan = document.getElementById('paymentPlan').value;

        // Only auto-calculate if key fields are filled
        if (destination && boardType && paymentPlan) {
            // Optional: you can enable this for auto-calculation
            // calculatePayment();
        }
    });
</script>
</body>

{% endblock content %}